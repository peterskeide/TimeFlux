<h1>Review Month
  <%= @current_user.admin ? "for #{h @user.fullname}" : '' %>
</h1>

<br/>

<% form_tag user_month_review_path(@user), :method => :get do %>
  <p>
    <label for="date">Period</label>
    <%= date_select "month_start_date", "date", {:start_year => Date.today.year - 5 , :end_year => Date.today.year + 1, :discard_day => true, :default => @period.start} %>
    <%= submit_tag 'View' %>
  </p>
<% end %>

<hr/>

<h4 class=""><%= @calendar.month_name -%></h4>

<%= render :partial => "activity_summary", :locals => { :activity_summary => @activity_summary, :user => @user, :beginning_of_month => @beginning_of_month } %>
<%= render :partial => "calendar_table", :locals => { :calendar => @calendar, :statistics => @statistics, :user => @user }%>

<% if @statistics.available? %>
  <br />
  <fieldset class="statistics">
    <legend>
      Statistics - <%= @calendar.month_name  %>
    </legend>
    <p>
      <label class="info">Balance</label>
      <span class="<%=case @statistics.balance when (0..9999) then "ok" when (-9999..0) then "red" end -%>">
      <%= "%+.1f" % @statistics.balance -%> </span> hours
    </p>
    <p>
      <label class="info">Billing degree</label> <%= @statistics.billing_degree %> %
    </p>
  </fieldset>
<% end %>

<br />
<hr style="clear:both"/>
<br/>

<div class="center">
  <% if @period.locked? -%>
    <input type="submit" value="You have submitted this month" disabled="true">
  <% elsif @period.ready_for_approval? -%>
    <p>
      <% form_tag lock_user_time_entries_path(@user) do -%>
        <%= hidden_field_tag "user_id", @user.id %>
        <%= hidden_field_tag "start_date", @period.start %>
        <%= hidden_field_tag "end_date", @period.end %>
        <%= submit_tag "Submit for billing"%>
      <% end -%>
    </p>
  <% else -%>
    <input type="submit" value="Not ready for submission" disabled="true">
  <% end -%>
</div>